#
# CHEF MANAGED FILE: DO NOT EDIT
# Generated by Chef for <%= node['hostname'] %>
# Controlling Cookbook: <%=  @cookbook_name %>
#
<%- unless @mysql.nil? -%>
<%-   node['apache']['sites'].each do |site_name| -%>
<%-     site_name = site_name[0] -%>
[MySQL-<%= site_name -%>]
master-host = <%= node['mysql-multi']['master'] %>
slave-hosts = <%= node['mysql-multi']['slaves'].join(', ') %>
port = <%= node['mysql']['port'] %>

<%-     @mysql['apache']['sites'][site_name]['databases'].each do |database| -%>
<%-       database = database[0] -%>
db_name = <%= database %>
username = <%= @mysql['apache']['sites'][site_name]['databases'][database]['mysql_user'] %>
password = <%= @mysql['apache']['sites'][site_name]['databases'][database]['mysql_password'] %>

<%-     end -%>
<%-   end -%>
<%- end -%>
<%- unless @rabbit_host.nil? -%>
<%-   node['apache']['sites'].each do |site_name| -%>
<%-     site_name = site_name[0] -%>
[RabbitMQ-<%= site_name -%>]
host = <%= @rabbit_host %>
port = <%= node['rabbitmq']['port'].nil? == true ? 5672 : node['rabbitmq']['port'] %>
vhost = <%= site_name %>
user = <%= site_name %>
pass = <%= @rabbit_passwords.nil? == true ? 'this_is_not_going_to_work' : @rabbit_passwords[site_name] %>

<%-   end -%>
<%- end -%>
